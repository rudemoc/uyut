<!-- /templates/room.html -->


{% extends "base.html" %}
{% block content %}
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">


<div id="main">
    <script type="application/json" id="room-messages-data">
        {{ messages | tojson | safe }}
    </script>
    <div id="room-data" 
        data-default-avatar="{{ default_avatar }}"
        data-user-id="{{ user.id }}"
        data-user-name="{{ user.display_name }}"
        data-user-avatar="{{ user.avatar }}"
        data-room-code="{{ room }}"
        style="display: none;">
    </div>
    
    <div id="header">
        <h1>{{ title }} <small style="color: #8899a6;">({{ room }})</small></h1>
        <div style="display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 5px; flex-wrap: wrap;">
            <img src="data:image/png;base64,{{ user.avatar }}" class="avatar" style="width: 24px; height: 24px;">
            <span style="color: #8899a6; font-size: 0.9em;">{{ user.display_name }}</span>
            <a href="{{ url_for('profile') }}" style="color: #19cf86; font-size: 0.8em; margin-left: 10px;">ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ</a>
            <a href="{{ url_for('home') }}" style="color: #19cf86; font-size: 0.8em; margin-left: 10px;">Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ</a>
        </div>
    </div>
    
    <div id="messages" class="scroll-container"></div>
    
    <form id="send-container" enctype="multipart/form-data">
        <div class="editor-toolbar">
            <button type="button" class="toolbar-button" id="bold-btn" title="Ğ–Ğ¸Ñ€Ğ½Ñ‹Ğ¹"><strong>B</strong></button>
            <button type="button" class="toolbar-button" id="italic-btn" title="ĞšÑƒÑ€ÑĞ¸Ğ²"><em>I</em></button>
            <select id="size-select" class="toolbar-button" style="border-radius: 20px; padding: 0 8px;" title="Ğ Ğ°Ğ·Ğ¼ĞµÑ€ Ñ‚ĞµĞºÑÑ‚Ğ°">
                <option value="">Ğ Ğ°Ğ·Ğ¼ĞµÑ€</option>
                <option value="1">ĞœĞ°Ğ»ĞµĞ½ÑŒĞºĞ¸Ğ¹</option>
                <option value="3">ĞĞ±Ñ‹Ñ‡Ğ½Ñ‹Ğ¹</option>
                <option value="5">Ğ‘Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹</option>
                <option value="7">ĞĞ³Ñ€Ğ¾Ğ¼Ğ½Ñ‹Ğ¹</option>
            </select>
            <button type="button" class="toolbar-button" id="emoji-btn" title="Ğ­Ğ¼Ğ¾Ğ´Ğ·Ğ¸">ğŸ˜Š</button>
            
            <!-- Twitter-style file input -->
            <div class="file-input-container">
                <button type="button" class="toolbar-button file-input-button" title="ĞŸÑ€Ğ¸ĞºÑ€ĞµĞ¿Ğ¸Ñ‚ÑŒ Ñ„Ğ°Ğ¹Ğ»">
                    ğŸ“
                </button>
                <input type="file" id="file-input" name="file" multiple
                    accept="image/*,video/*,audio/*,.gif,.zip,.pdf,.txt,.doc,.docx,.xlsx,.ppt,.pptx">
            </div>
            
            <div id="emoji-picker" class="emoji-picker hidden">
                <div class="emoji-picker-header">
                    <span>Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ÑĞ¼Ğ¾Ğ´Ğ·Ğ¸</span>
                    <button type="button" id="close-emoji-picker" class="close-emoji">âœ•</button>
                </div>
                <div class="emoji-grid">
                    <button class="emoji">ğŸ˜€</button>
                    <button class="emoji">ğŸ˜‚</button>
                    <button class="emoji">ğŸ˜</button>
                    <button class="emoji">â¤ï¸</button>
                    <button class="emoji">ğŸ‘</button>
                    <button class="emoji">ğŸ‘</button>
                    <button class="emoji">ğŸ”¥</button>
                    <button class="emoji">ğŸ‰</button>
                    <button class="emoji">ğŸ¤”</button>
                    <button class="emoji">ğŸ˜¢</button>
                    <button class="emoji">ğŸ˜¡</button>
                    <button class="emoji">ğŸ¥³</button>
                    <button class="emoji">ğŸš€</button>
                    <button class="emoji">ğŸŒŸ</button>
                    <button class="emoji">ğŸ•</button>
                    <button class="emoji">ğŸ¶</button>
                    <button class="emoji">ğŸ±</button>
                    <button class="emoji">ğŸŒˆ</button>
                    <button class="emoji">âš¡</button>
                    <button class="emoji">ğŸ“¸</button>
                </div>
            </div>
        </div>
        
        <div class="resizer-top" title="Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ²Ñ‹ÑĞ¾Ñ‚Ñƒ Ğ¿Ğ¾Ğ»Ñ Ğ²Ğ²Ğ¾Ğ´Ğ°"></div>
        
        <div id="message-editor" contenteditable="true" data-placeholder="Ğ§Ñ‚Ğ¾ Ñƒ Ğ²Ğ°Ñ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾?"></div>
        
        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 12px;">
            <span id="char-counter" style="color: #8899a6; font-size: 0.8em;">0/512</span>
            <button type="submit" id="send-button" class="submit-button">ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ</button>
        </div>
    </form>
    
    <!-- Image viewer for full-size media -->
    <div id="image-viewer" class="image-viewer hidden">
        <div class="image-viewer-content">
            <img id="viewer-image" src="" alt="ĞŸĞ¾Ğ»Ğ½Ğ¾Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ğ½Ğ¾Ğµ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ">
            <button id="close-viewer" class="close-button">âœ•</button>
        </div>
    </div>
    
    <!-- Cooldown overlay -->
    <div id="cooldown-overlay" class="cooldown-overlay hidden">
        <div class="cooldown-timer">
            <span id="cooldown-seconds">1</span> ÑĞµĞºÑƒĞ½Ğ´Ğ° Ğ´Ğ¾ ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ³Ğ¾ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ
            <div class="cooldown-progress"></div>
        </div>
    </div>

</div>

<style>
#char-counter {
    padding: 0 10px;
}

.message .avatar {
    cursor: pointer;
    transition: opacity 0.2s ease;
}

.message .avatar:active {
    opacity: 0.8;
}

/* Context menu styles */
.message-context-menu {
    position: fixed;
    background: #253341;
    border: 1px solid #38444d;
    border-radius: 12px;
    padding: 8px 0;
    z-index: 1000;
    min-width: 200px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
}

.context-menu-item {
    padding: 12px 16px;
    cursor: pointer;
    color: #d9d9d9;
    border-bottom: 1px solid #38444d;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}

.context-menu-item:last-child {
    border-bottom: none;
}

.context-menu-item:active {
    background: #38444d;
}

.context-menu-item.delete {
    color: #e0245e;
}

/* Mobile optimizations */
@media (max-width: 768px) {
    #header {
        padding: 10px 12px;
    }
    
    #header h1 {
        font-size: 1.2em;
    }
    
    #header div {
        gap: 8px;
    }
    
    .editor-toolbar {
        padding: 6px;
        gap: 6px;
    }
    
    .toolbar-button {
        min-width: 40px;
        min-height: 40px;
        padding: 8px;
    }
    
    #message-editor {
        min-height: 100px;
        padding: 14px;
    }
}

@media (max-width: 480px) {
    #header h1 {
        font-size: 1.1em;
    }
    
    .editor-toolbar {
        gap: 4px;
        padding: 4px;
    }
    
    .toolbar-button {
        min-width: 36px;
        min-height: 36px;
        padding: 6px;
        font-size: 0.9em;
    }
    
    #message-editor {
        min-height: 80px;
        padding: 12px;
    }
}
</style>
{% endblock %}