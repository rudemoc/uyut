{% extends "base.html" %}
{% block content %}
<div class="home-container">
    <!-- –•–µ–¥–µ—Ä —Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π -->
    <div class="home-header">
        <div class="header-content">
            
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="home-main">
        <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –±—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
        <div class="left-column">
            <div class="user-card">
                <img src="data:image/png;base64,{{ user.avatar }}" class="user-avatar" alt="–ê–≤–∞—Ç–∞—Ä">
                <div class="user-info">
                    <h3>{{ user.display_name }}</h3>
                    <p>@{{ user.username }}</p>
                </div>
                <div class="user-actions">
                    <a href="{{ url_for('profile') }}" class="profile-link">üë§ –ü—Ä–æ—Ñ–∏–ª—å</a>
                    <a href="{{ url_for('notifications_page') }}" class="notifications-link">üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</a>
                </div>
            </div>

            <!-- –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ -->
            <div class="quick-search">
                <div class="search-header">
                    <h3>üîç –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫</h3>
                </div>
                <div class="search-container">
                    <input type="text" 
                           id="room-search" 
                           class="search-input" 
                           placeholder="–ù–∞–π—Ç–∏ –∫–æ–º–Ω–∞—Ç—ã..."
                           autocomplete="off">
                    <div id="search-results" class="search-results"></div>
                </div>
            </div>
        </div>

        <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
        <div class="center-column">
            <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è -->
            <div class="action-card join-card">
                <div class="card-header">
                    <div class="card-icon">üö™</div>
                    <h3>–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∫–æ–º–Ω–∞—Ç–µ</h3>
                </div>
                <form id="join-form" class="action-form">
                    <div class="input-group">
                        <input type="text" 
                               name="code" 
                               id="code" 
                               placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∫–æ–º–Ω–∞—Ç—ã"
                               value="{{ code or '' }}"
                               class="modern-input">
                        <button type="submit" class="modern-btn primary-btn">
                            <span class="btn-text">–í–æ–π—Ç–∏</span>
                            <span class="btn-icon">‚Üí</span>
                        </button>
                    </div>
                </form>
            </div>

            <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è -->
            <div class="action-card create-card">
                <div class="card-header">
                    <div class="card-icon">‚ú®</div>
                    <h3>–°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É</h3>
                </div>
                <form id="create-form" class="action-form">
                    <div class="input-group vertical">
                        <input type="text" 
                               name="title" 
                               id="title" 
                               placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"
                               class="modern-input">
                        
                        <label class="checkbox-modern">
                            <input type="checkbox" name="is_public" id="is_public">
                            <span class="checkmark"></span>
                            <span class="checkbox-text">–ü—É–±–ª–∏—á–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞</span>
                        </label>
                        
                        <button type="submit" class="modern-btn success-btn">
                            <span class="btn-text">–°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É</span>
                            <span class="btn-icon">‚ûï</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –ø—É–±–ª–∏—á–Ω—ã–µ –∫–æ–º–Ω–∞—Ç—ã -->
        <div class="right-column">
            <div class="rooms-card">
                <div class="card-header">
                    <div class="card-icon">üåê</div>
                    <h3>–ö–æ–º–Ω–∞—Ç—ã</h3>
                    <button class="refresh-btn" id="refresh-rooms">üîÑ</button>
                </div>
                <div id="public-rooms" class="rooms-list">
                    <div class="loading-state">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–Ω–∞—Ç...</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ—à–∏–±–æ–∫ -->
<div id="error-modal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h3>–û—à–∏–±–∫–∞</h3>
            <button class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
            <p id="error-message"></p>
        </div>
    </div>
</div>

<style>
/* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–æ–º–∞—à–Ω–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
.home-container {
    min-height: 100vh;
    background: linear-gradient(135deg, #15202b 0%, #1c2d3d 100%);
    padding: 20px;
}

.home-header {
    margin-bottom: 30px;
}

.header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 20px;
}

.logo {
    font-size: 2.5em;
    font-weight: bold;
    background: linear-gradient(135deg, #19cf86, #1fd1a4);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin: 0;
}

.user-stats {
    display: flex;
    gap: 30px;
}

.stat-item {
    text-align: center;
}

.stat-number {
    display: block;
    font-size: 1.8em;
    font-weight: bold;
    color: #19cf86;
}

.stat-label {
    font-size: 0.9em;
    color: #8899a6;
}

.home-main {
    display: grid;
    grid-template-columns: 300px 1fr 350px;
    gap: 25px;
    max-width: 1400px;
    margin: 0 auto;
}

/* –ö–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è */
.user-card {
    background: rgba(37, 51, 65, 0.8);
    backdrop-filter: blur(10px);
    border: 1px solid #38444d;
    border-radius: 20px;
    padding: 25px;
    margin-bottom: 25px;

    justify-content: center;
    align-items: center;
}

.user-avatar {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    margin-bottom: 15px;
    
}

.user-info h3 {
    margin: 0 0 5px 0;
    color: #d9d9d9;
    font-size: 1.2em;
}

.user-info p {
    margin: 0;
    color: #8899a6;
    font-size: 0.9em;
}

.user-actions {
    margin-top: 15px;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.profile-link, .notifications-link {
    padding: 10px 15px;
    background: rgba(56, 68, 77, 0.6);
    color: #d9d9d9;
    text-decoration: none;
    border-radius: 12px;
    text-align: center;
    transition: all 0.3s ease;
    font-size: 0.9em;
}

.profile-link:hover, .notifications-link:hover {
    background: #38444d;
    transform: translateY(-2px);
}

/* –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ */
.quick-search {
    background: rgba(37, 51, 65, 0.8);
    backdrop-filter: blur(10px);
    border: 1px solid #38444d;
    border-radius: 20px;
    padding: 25px;  
}

.search-header h3 {
    margin: 0 0 15px 0;
    color: #d9d9d9;
    font-size: 1.1em;
}

/* –ö–∞—Ä—Ç–æ—á–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */
.action-card {
    background: rgba(37, 51, 65, 0.8);
    backdrop-filter: blur(10px);
    border: 1px solid #38444d;
    border-radius: 20px;
    padding: 30px;
    margin-bottom: 25px;
}

.card-header {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 25px;
}

.card-icon {
    font-size: 1.5em;
}

.card-header h3 {
    margin: 0;
    color: #d9d9d9;
    font-size: 1.3em;
}

/* –§–æ—Ä–º—ã */
.action-form {
    width: 100%;
}

.input-group {
    display: flex;
    gap: 12px;
    align-items: flex-end;
}

.input-group.vertical {
    flex-direction: column;
    align-items: stretch;
    gap: 20px;
}

.modern-input {
    flex: 1;
    background: rgba(21, 32, 43, 0.6);
    border: 2px solid #38444d;
    border-radius: 15px;
    padding: 15px 20px;
    color: #d9d9d9;
    font-size: 1em;
    transition: all 0.3s ease;
}

.modern-input:focus {
    outline: none;
    border-color: #19cf86;
    background: rgba(21, 32, 43, 0.8);
}

/* –ö–Ω–æ–ø–∫–∏ */
.modern-btn {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 15px 25px;
    border: none;
    border-radius: 15px;
    font-size: 1em;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
}

.primary-btn {
    background: linear-gradient(135deg, #19cf86, #16b677);
    color: #15202b;
}

.success-btn {
    background: linear-gradient(135deg, #19cf86, #16b677);
    color: #15202b;
    width: 100%;
    justify-content: center;
}

.modern-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(25, 207, 134, 0.3);
}

/* –ß–µ–∫–±–æ–∫—Å */
.checkbox-modern {
    display: flex;
    align-items: center;
    gap: 12px;
    cursor: pointer;
    color: #d9d9d9;
    font-size: 1em;
}

.checkbox-modern input {
    display: none;
}

.checkmark {
    width: 22px;
    height: 22px;
    border: 2px solid #38444d;
    border-radius: 6px;
    position: relative;
    transition: all 0.3s ease;
}

.checkbox-modern input:checked + .checkmark {
    background: #19cf86;
    border-color: #19cf86;
}

.checkbox-modern input:checked + .checkmark::after {
    content: '‚úì';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: #15202b;
    font-weight: bold;
    font-size: 14px;
}

/* –°–ø–∏—Å–æ–∫ –∫–æ–º–Ω–∞—Ç */
.rooms-card {
    background: rgba(37, 51, 65, 0.8);
    backdrop-filter: blur(10px);
    border: 1px solid #38444d;
    border-radius: 20px;
    padding: 30px;
    height: fit-content;
    position: sticky;
    top: 20px;
}

.rooms-card .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.refresh-btn {
    background: none;
    border: none;
    color: #3c4247ff;
    font-size: 1.2em;
    cursor: pointer;
    padding: 8px;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.refresh-btn:hover {
    background: #2d363dff;
    color: #d9d9d9;
    transform: rotate(180deg);
}

.rooms-list {
    max-height: 500px;
    overflow-y: auto;
}

.room-item {
    background: rgba(21, 32, 43, 0.6);
    border: 1px solid #38444d;
    border-radius: 15px;
    padding: 20px;
    margin-bottom: 15px;
    transition: all 0.3s ease;
}

.room-item:hover {
    border-color: #19cf86;
    transform: translateY(-2px);
}

.room-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 10px;
}

.room-title {
    font-weight: bold;
    color: #d9d9d9;
    margin: 0;
    font-size: 1.1em;
}

.room-members {
    display: flex;
    align-items: center;
    gap: 5px;
    color: #19cf86;
    font-size: 0.9em;
    background: rgba(25, 207, 134, 0.1);
    padding: 4px 10px;
    border-radius: 12px;
}

.room-code {
    
}

.join-room-btn {
    width: 100%;
    background: rgba(25, 207, 134, 0.1);
    color: #19cf86;
    border: 1px solid rgba(25, 207, 134, 0.3);
    padding: 12px;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 600;
}

.join-room-btn:hover {
    background: #19cf86;
    color: #15202b;
    transform: translateY(-1px);
}

/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

.modal-content {
    background: #253341;
    border-radius: 20px;
    border: 1px solid #38444d;
    width: 90%;
    max-width: 400px;
}

.modal-header {
    padding: 20px 25px;
    border-bottom: 1px solid #38444d;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h3 {
    margin: 0;
    color: #d9d9d9;
}

.close-modal {
    background: none;
    border: none;
    color: #8899a6;
    font-size: 1.5em;
    cursor: pointer;
    padding: 0;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal-body {
    padding: 25px;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 1200px) {
    .home-main {
        grid-template-columns: 280px 1fr;
    }
    
    .right-column {
        grid-column: 1 / -1;
        margin-top: 20px;
    }
    
    .rooms-card {
        position: static;
    }
}

@media (max-width: 768px) {
    .home-container {
        padding: 15px;
    }
    
    .home-main {
        grid-template-columns: 1fr;
        gap: 20px;
    }
    
    .header-content {
        flex-direction: column;
        text-align: center;
    }
    
    .user-stats {
        justify-content: center;
    }
    
    .left-column, .center-column, .right-column {
        width: 100%;
    }
    
    .input-group {
        flex-direction: column;
    }
    
    .modern-btn {
        width: 100%;
        justify-content: center;
    }
}

@media (max-width: 480px) {
    .home-container {
        padding: 10px;
    }
    
    .logo {
        font-size: 2em;
    }
    
    .action-card, .user-card, .quick-search, .rooms-card {
        padding: 20px;
    }
    
    .stat-number {
        font-size: 1.5em;
    }
}
</style>

<script>
class HomeManager {
    constructor() {
        this.init();
    }

    init() {
        this.setupEventListeners();
        this.loadPublicRooms();
        this.setupSearch();
    }

    setupEventListeners() {
        // –§–æ—Ä–º–∞ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        const joinForm = document.getElementById('join-form');
        if (joinForm) {
            joinForm.addEventListener('submit', (e) => this.handleJoin(e));
        }

        // –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è
        const createForm = document.getElementById('create-form');
        if (createForm) {
            createForm.addEventListener('submit', (e) => this.handleCreate(e));
        }

        // –ö–Ω–æ–ø–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–º–Ω–∞—Ç
        const refreshBtn = document.getElementById('refresh-rooms');
        if (refreshBtn) {
            refreshBtn.addEventListener('click', () => this.loadPublicRooms());
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        const closeModal = document.querySelector('.close-modal');
        if (closeModal) {
            closeModal.addEventListener('click', () => this.hideError());
        }
    }

    setupSearch() {
        const searchInput = document.getElementById('room-search');
        const resultsContainer = document.getElementById('search-results');
        
        if (!searchInput || !resultsContainer) return;

        let searchTimeout;

        searchInput.addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            const query = e.target.value.trim();
            
            if (query.length < 2) {
                resultsContainer.style.display = 'none';
                return;
            }

            searchTimeout = setTimeout(() => {
                this.searchRooms(query);
            }, 300);
        });

        // –ó–∞–∫—Ä—ã—Ç–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ
        document.addEventListener('click', (e) => {
            if (!searchInput.contains(e.target) && !resultsContainer.contains(e.target)) {
                resultsContainer.style.display = 'none';
            }
        });
    }

    async searchRooms(query) {
        try {
            const response = await fetch(`/api/search-rooms?q=${encodeURIComponent(query)}`);
            const data = await response.json();
            this.displaySearchResults(data.rooms || []);
        } catch (error) {
            console.error('Search error:', error);
        }
    }

    displaySearchResults(rooms) {
        const container = document.getElementById('search-results');
        if (!container) return;

        if (rooms.length === 0) {
            container.innerHTML = '<div class="search-result-item">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
        } else {
            container.innerHTML = rooms.map(room => `
                <div class="search-result-item" data-code="${room.code}">
                    <div class="search-result-content">
                        <div class="search-result-title">${this.escapeHtml(room.title)}</div>
                        <div class="search-result-meta">
                            <span class="search-result-code">${room.code}</span>
                            <span class="search-result-members">üë• ${room.members}</span>
                        </div>
                    </div>
                    <button class="join-search-result" data-code="${room.code}">
                        –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è
                    </button>
                </div>
            `).join('');

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            container.querySelectorAll('.search-result-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    if (!e.target.classList.contains('join-search-result')) {
                        this.selectRoom(item.dataset.code);
                    }
                });
            });

            container.querySelectorAll('.join-search-result').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.selectRoom(btn.dataset.code);
                });
            });
        }

        container.style.display = 'block';
    }

    selectRoom(roomCode) {
        const codeInput = document.getElementById('code');
        if (codeInput) {
            codeInput.value = roomCode;
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º—É
            document.getElementById('join-form').dispatchEvent(new Event('submit'));
        }
    }

    async handleJoin(e) {
        e.preventDefault();
        const formData = new FormData(e.target);
        const code = formData.get('code').trim();

        if (!code) {
            this.showError('–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∫–æ–º–Ω–∞—Ç—ã');
            return;
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã
        try {
            const response = await fetch(`/api/check-room?code=${encodeURIComponent(code)}`);
            const data = await response.json();

            if (data.exists) {
                // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –≤ –∫–æ–º–Ω–∞—Ç—É
                window.location.href = `/room?room=${code}`;
            } else {
                this.showError('–ö–æ–º–Ω–∞—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–¥ –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –∫–æ–º–Ω–∞—Ç—É.');
            }
        } catch (error) {
            this.showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∫–æ–º–Ω–∞—Ç—ã');
        }
    }

    async handleCreate(e) {
        e.preventDefault();
        const formData = new FormData(e.target);
        const title = formData.get('title').trim();
        const isPublic = formData.get('is_public') === 'on';

        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã
        try {
            const response = await fetch('/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({
                    'create': 'create',
                    'title': title,
                    'is_public': isPublic
                })
            });

            if (response.ok) {
                // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –≤ —Å–æ–∑–¥–∞–Ω–Ω—É—é –∫–æ–º–Ω–∞—Ç—É
                window.location.href = '/room';
            } else {
                this.showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–º–Ω–∞—Ç—ã');
            }
        } catch (error) {
            this.showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–º–Ω–∞—Ç—ã');
        }
    }

    async loadPublicRooms() {
        const container = document.getElementById('public-rooms');
        if (!container) return;

        container.innerHTML = '<div class="loading-state">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–Ω–∞—Ç...</div>';

        try {
            const response = await fetch('/api/public-rooms');
            const data = await response.json();
            this.renderPublicRooms(data.rooms || []);
        } catch (error) {
            console.error('Error loading public rooms:', error);
            container.innerHTML = '<div class="error-state">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–º–Ω–∞—Ç</div>';
        }
    }

    renderPublicRooms(rooms) {
        const container = document.getElementById('public-rooms');
        if (!container) return;

        if (!rooms.length) {
            container.innerHTML = '<div class="empty-state">–ü—É–±–ª–∏—á–Ω—ã—Ö –∫–æ–º–Ω–∞—Ç –ø–æ–∫–∞ –Ω–µ—Ç. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</div>';
            return;
        }

        container.innerHTML = rooms.map(room => `
            <div class="room-item">
            <button class="join-room-btn" data-code="${room.code}">
                
                    <h4 class="room-title">
                    ${this.escapeHtml(room.title)}</h4>
                    
                    <div class="room-members">
                        üë• ${room.members}
                        –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è
                    </div>
            </button>
                </div>
            </div>
        `).join('');

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        container.querySelectorAll('.join-room-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                this.selectRoom(btn.dataset.code);
            });
        });
    }

    showError(message) {
        const modal = document.getElementById('error-modal');
        const messageEl = document.getElementById('error-message');
        
        if (modal && messageEl) {
            messageEl.textContent = message;
            modal.classList.remove('hidden');
        }
    }

    hideError() {
        const modal = document.getElementById('error-modal');
        if (modal) {
            modal.classList.add('hidden');
        }
    }

    escapeHtml(text) {
        if (!text) return '';
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
document.addEventListener('DOMContentLoaded', function() {
    window.homeManager = new HomeManager();
    
    // –ê–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–æ–º–Ω–∞—Ç –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
    setInterval(() => {
        window.homeManager.loadPublicRooms();
    }, 30000);
});
</script>

<!-- –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞ -->
<style>
.search-container {
    position: relative;
}

.search-results {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: #253341;
    border: 1px solid #38444d;
    border-radius: 15px;
    margin-top: 10px;
    max-height: 300px;
    overflow-y: auto;
    z-index: 100;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    display: none;
}

.search-result-item {
    padding: 15px 20px;
    border-bottom: 1px solid #38444d;
    cursor: pointer;
    transition: background-color 0.3s ease;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 15px;
}

.search-result-item:last-child {
    border-bottom: none;
}

.search-result-item:hover {
    background: #38444d;
}

.search-result-content {
    flex: 1;
    min-width: 0;
}

.search-result-title {
    color: #d9d9d9;
    font-weight: bold;
    margin-bottom: 5px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.search-result-meta {
    display: flex;
    gap: 15px;
    font-size: 0.85em;
    color: #8899a6;
}

.search-result-code {
    font-family: 'Courier New', monospace;
}

.join-search-result {
    background: rgba(25, 207, 134, 0.1);
    color: #19cf86;
    border: 1px solid rgba(25, 207, 134, 0.3);
    padding: 8px 15px;
    border-radius: 10px;
    font-size: 0.9em;
    cursor: pointer;
    transition: all 0.3s ease;
    flex-shrink: 0;
}

.join-search-result:hover {
    background: #19cf86;
    color: #15202b;
}

.loading-state, .empty-state, .error-state {
    text-align: center;
    padding: 40px 20px;
    color: #8899a6;
    font-style: italic;
}
</style>
{% endblock %}