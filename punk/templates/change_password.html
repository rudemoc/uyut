<!-- /templates/change_password.html -->

{% extends "base.html" %}
{% block content %}
<div id="main">
    <div class="header">
        <h1>Смена пароля</h1>
    </div>

    <form method="post" class="form-container">
        <div class="form-group">
            <label for="current_password">Текущий пароль:</label>
            <input type="password" name="current_password" id="current_password" 
                   placeholder="Введите текущий пароль" 
                   required
                   style="background-color: #253341; color: #d9d9d9; border: 1px solid #38444d; padding: 12px; border-radius: 8px; width: 100%; font-size: 16px;">
        </div>

        <div class="form-group">
            <label for="new_password">Новый пароль:</label>
            <input type="password" name="new_password" id="new_password" 
                   placeholder="Придумайте новый пароль" 
                   required
                   minlength="6"
                   style="background-color: #253341; color: #d9d9d9; border: 1px solid #38444d; padding: 12px; border-radius: 8px; width: 100%; font-size: 16px;">
            <small style="color: #8899a6;">Минимум 6 символов</small>
        </div>

        <div class="form-group">
            <label for="confirm_password">Подтверждение нового пароля:</label>
            <input type="password" name="confirm_password" id="confirm_password" 
                   placeholder="Повторите новый пароль" 
                   required
                   minlength="6"
                   style="background-color: #253341; color: #d9d9d9; border: 1px solid #38444d; padding: 12px; border-radius: 8px; width: 100%; font-size: 16px;">
        </div>

        {% if error %}
        <div class="error-message" style="color: #e0245e; background: #2d1a23; padding: 12px; border-radius: 8px; border: 1px solid #e0245e; margin: 10px 0;">
            {{ error }}
        </div>
        {% endif %}

        {% if success %}
        <div class="success-message" style="color: #19cf86; background: #1a2d26; padding: 12px; border-radius: 8px; border: 1px solid #19cf86; margin: 10px 0;">
            {{ success }}
        </div>
        {% endif %}

        <button type="submit" class="submit-button" style="background-color: #19cf86; color: #15202b; border: none; padding: 12px 24px; border-radius: 20px; font-weight: bold; width: 100%; cursor: pointer; font-size: 1em; margin-top: 15px;">
            Сменить пароль
        </button>
    </form>

    <div class="profile-actions" style="margin-top: 20px;">
        <a href="{{ url_for('profile') }}" class="back-button">← Назад к профилю</a>
        <a href="{{ url_for('home') }}" class="back-button">На главную</a>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const currentPasswordInput = document.getElementById('current_password');
    const newPasswordInput = document.getElementById('new_password');
    const confirmPasswordInput = document.getElementById('confirm_password');
    
    // Автофокус на текущий пароль
    if (currentPasswordInput) {
        currentPasswordInput.focus();
    }

    // Проверка совпадения паролей
    function validatePasswords() {
        if (newPasswordInput.value && confirmPasswordInput.value) {
            if (newPasswordInput.value !== confirmPasswordInput.value) {
                confirmPasswordInput.style.borderColor = '#e0245e';
            } else {
                confirmPasswordInput.style.borderColor = '#19cf86';
            }
        }
    }

    if (newPasswordInput && confirmPasswordInput) {
        newPasswordInput.addEventListener('input', validatePasswords);
        confirmPasswordInput.addEventListener('input', validatePasswords);
    }
    
    // Очистка ошибки при изменении ввода
    const inputs = document.querySelectorAll('input');
    inputs.forEach(input => {
        input.addEventListener('input', function() {
            const errorElement = document.querySelector('.error-message');
            if (errorElement) {
                errorElement.style.display = 'none';
            }
        });
    });
});
</script>

<style>
.profile-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 10px;
}

.back-button {
    color: #19cf86;
    text-decoration: none;
    padding: 10px 20px;
    border: 1px solid #38444d;
    border-radius: 20px;
    display: inline-block;
    text-align: center;
    flex: 1;
}

@media (max-width: 800px) {
    .profile-actions {
        flex-direction: column;
    }
    
    .back-button {
        width: 100%;
    }
}
</style>
{% endblock %}